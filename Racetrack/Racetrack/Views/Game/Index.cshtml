@{
    ViewBag.Title = "Game";
}
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="StyleSheet.css" />
</head>
<body>
    <h2>Racetrack</h2>
    <div class="container">
        <input type="text" id="message" />
        <input type="button" id="sendmessage" value="Send" />
        <input type="hidden" id="displayname" />
        <canvas id="arena"></canvas>
        @*<object id="arena"></object>*@ @*делает маленькую картинку*@
    </div>

    @*<object id="arena"></object>*@ @*делает маленькую картинку*@

    @*<div class="container">
        <img src="street.png" />
        <div id="arena">
            <div id="player1"></div>
            <div id="player2"></div>
            <div id="player3"></div>
            <div id="player4"></div>
            <div id="circle-empty-big-1"></div>
            <div id="circle-empty-small-1"></div>
            <div id="circle-empty-big-2"></div>
            <div id="circle-empty-small-2"></div>
            <div id="circle-empty-big-3"></div>
            <div id="circle-empty-small-3"></div>
            <div id="circle-empty-big-4"></div>
            <div id="circle-empty-small-4"></div>
            <div id="circle-empty-big-5"></div>
            <div id="circle-empty-small-5"></div>
            <div id="circle-empty-big-6"></div>
            <div id="circle-empty-small-6"></div>
            <div id="circle-empty-big-7"></div>
            <div id="circle-empty-small-7"></div>
            <div id="circle-empty-big-8"></div>
            <div id="circle-empty-small-8"></div>
            <div id="circle-empty-big-9"></div>
            <div id="circle-empty-small-9"></div>
        </div>
    </div>*@
</body>
</html>
@section scripts {
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="../../Scripts/jquery-3.1.1.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="../../Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        $(function () {
            var map;

            function showWorld() {
                //$('#world').html('');
                //for (var i = 0; i < map.length; ++i) {
                //	for (var j = 0; j < map[i].length; ++j) {
                //		$('#world').append(map[i][j] + ' ');
                //	}
                //	$('#world').append('\n');
                //}

                $('document').ready(function () {
                    $("#arena").show();
                });
            };

            var game = $.connection.gameHub;

            game.client.showMap = function (worldModel) {
                map = worldModel.Map.slice();
                showWorld();
            };

            game.client.showMovements = function (round, name, prevPos, curPos) {
                map[prevPos.Y][prevPos.X] = 0;
                map[curPos.Y][curPos.X] = 2;
                $('document').ready(function () {
                    var delatX = curPos.X - prev.X;
                    var oldX = $('#arena').find(name).get('left');
                    var deltaY = CurPos.Y - prevPos.Y;
                    var oldY = $('#arena').find(name).get('top');
                    $('#arena').find(name).css( 
                        {'left' : oldX + delatX, 'top' : oldY + deltaY })
                });
                showWorld();
            };
            var isCrashed = false;
            game.client.onCrash = function () {
                alert("You lose :(");
                isCrashed = true;
                document.getElementById('sendmessage').disabled = true;
            };
            game.client.beginNextRound = function () {
                if (!isCrashed) {
                    document.getElementById('sendmessage').disabled = false;
                }
            };
            game.client.showEndOfGame = function (isWinner) {
                if (isWinner) {
                    alert("You win!");
                } else {
                    if (!isCrashed) {
                        alert("You lose :(");
                    }
                }
                document.location.href = "/";
            };
            $('#message').focus();
            $.connection.hub.start()
                .done(function () {
                    $('#sendmessage')
                        .click(function () {
                            game.server.updatePlayer({
                                key: $('#message').val()
                            });
                            $('#message').val('').focus();
                            document.getElementById('sendmessage').disabled = true;
                        });
                });
        });
    </script>
}
